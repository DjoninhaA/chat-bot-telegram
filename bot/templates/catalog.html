<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Produtos</title>
    <style>
        .product {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px;
            text-align: center;
        }
        .product img {
            max-width: 100%;
            height: auto;
        }
        .category-menu {
            margin-bottom: 20px;
        }
        .category-menu button {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h1>Catálogo de Produtos</h1>
    <div class="category-menu" id="category-menu">
        {% for category in products.produtos|dictsort:"categoria__nome" %}
            <button onclick="loadProducts('{{ category.0 }}')">{{ category.0 }}</button>
        {% endfor %}
    </div>
    <div id="products">
        {% for product in products.produtos %}
            <div class="product">
                <h2>{{ product.nome }}</h2>
                <p>{{ product.descricao }}</p>
                <p>Preço: {{ product.preco }}</p>
                <p>Tempo de Preparo: {{ product.tempoDePreparo }} minutos</p>
                <p>Subcategoria: {{ product.subcategoria }}</p>
                <p>Categoria: {{ product.categoria__nome }}</p>
                <button onclick="addToCart('{{ product.nome }}')">Adicionar ao Carrinho</button>
            </div>
        {% endfor %}
    </div>
    <script>
        const allProducts = JSON.parse(document.getElementById('products-data').textContent);

        function loadProducts(category) {
            const productsDiv = document.getElementById('products');
            productsDiv.innerHTML = '';
            allProducts.produtos.filter(product => product.categoria__nome === category).forEach(product => {
                const productDiv = document.createElement('div');
                productDiv.className = 'product';
                productDiv.innerHTML = `
                    <h2>${product.nome}</h2>
                    <p>${product.descricao}</p>
                    <p>Preço: ${product.preco}</p>
                    <p>Tempo de Preparo: ${product.tempoDePreparo} minutos</p>
                    <p>Subcategoria: ${product.subcategoria}</p>
                    <p>Categoria: ${product.categoria__nome}</p>
                    <button onclick="addToCart('${product.nome}')">Adicionar ao Carrinho</button>
                `;
                productsDiv.appendChild(productDiv);
            });
        }

        function addToCart(productName) {
            fetch('/api/add_to_cart/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({ product_name: productName })
            }).then(response => response.json())
              .then(data => {
                  alert(data.message);
              });
        }
    </script>
    <script id="products-data" type="application/json">{{ products|json_script:"products-data" }}</script>
</body>
</html>